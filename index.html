<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bac Tunisie Hub</title>
    
    <!-- 1. Tailwind CSS (Design) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- 3. Babel (Pour comprendre le JSX) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* Custom Scrollbar */
        .custom-scrollbar::-webkit-scrollbar { height: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fadeIn { animation: fadeIn 0.5s ease-out; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 transition-colors duration-300">
    <div id="root"></div>

    <!-- 4. NOTRE APPLICATION -->
    <script type="text/babel" data-type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, orderBy, query } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        // --- A. CONFIGURATION FIREBASE (REMPLACEZ CECI) ---
        const firebaseConfig = {
              apiKey: "AIzaSyA0EvT1wX89zK6RYbyoWwoxfQjVsi_iro4",
              authDomain: "bac-tunisie-hub.firebaseapp.com",
              projectId: "bac-tunisie-hub",
              storageBucket: "bac-tunisie-hub.firebasestorage.app",
              messagingSenderId: "197783232548",
              appId: "1:197783232548:web:b43ba650d3a4819e1fb8b1",
              measurementId: "G-CGYVK8DR0B"
        };

        // --- Initialisation Firebase ---
        let app, db, storage, auth;
        let configError = false;
        
        try {
            if (firebaseConfig.apiKey === "VOTRE_API_KEY_ICI") {
                configError = true;
            } else {
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                storage = getStorage(app);
                auth = getAuth(app);
            }
        } catch (e) {
            console.error("Firebase Error", e);
            configError = true;
        }

        const { useState, useEffect, useRef } = React;

        // --- ICONES SVG (Pour ne pas dépendre de lucide-react npm) ---
        const Icons = {
            GraduationCap: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 10v6M2 10l10-5 10 5-10 5z"/><path d="M6 12v5c3 0 6-3 6-7 0 5 6 7 6 7v-5M12 22v-7"/></svg>,
            Calculator: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="16" height="20" x="4" y="2" rx="2"/><line x1="8" x2="16" y1="6" y2="6"/><line x1="16" x2="16" y1="14" y2="18"/><path d="M16 10h.01"/><path d="M12 10h.01"/><path d="M8 10h.01"/><path d="M12 14h.01"/><path d="M8 14h.01"/><path d="M12 18h.01"/><path d="M8 18h.01"/></svg>,
            Book: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg>,
            Calendar: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></svg>,
            Upload: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></svg>,
            FileText: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" x2="8" y1="13" y2="13"/><line x1="16" x2="8" y1="17" y2="17"/><line x1="10" x2="8" y1="9" y2="9"/></svg>,
            Eye: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></svg>,
            Alert: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><path d="M12 9v4"/><path d="M12 17h.01"/></svg>,
            Loader: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="animate-spin"><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg>
        };

        // --- DONNÉES STATIQUES ---
        const BAC_DATA = {
            math: {
                label: "Mathématiques",
                color: "from-blue-600 to-indigo-600",
                subjects: [
                    { id: "math", name: "Mathématiques", coeff: 4, isOption: false },
                    { id: "phy", name: "Sciences Physiques", coeff: 4, isOption: false },
                    { id: "fr", name: "Français", coeff: 1, isOption: false },
                    { id: "eng", name: "Anglais", coeff: 1, isOption: false },
                    { id: "philo", name: "Philosophie", coeff: 1, isOption: false },
                    { id: "arabe", name: "Arabe", coeff: 1, isOption: false },
                    { id: "info", name: "Informatique", coeff: 1, isOption: false },
                    { id: "svt", name: "SVT", coeff: 1, isOption: false },
                    { id: "sport", name: "Sport", coeff: 1, isOption: false },
                    { id: "opt", name: "Option", coeff: 1, isOption: true }
                ],
                scoreFormula: (mg, g) => 4 * mg + 2 * (g.math||0) + 1.5 * (g.phy||0) + 0.5 * (g.fr||0) + 0.5 * (g.eng||0)
            }
            // Ajoutez d'autres sections ici...
        };

        // --- COMPOSANT ERREUR ---
        const ConfigError = () => (
            <div className="min-h-screen flex items-center justify-center bg-slate-100 p-4">
                <div className="bg-white p-8 rounded-xl shadow-xl max-w-md text-center">
                    <div className="text-red-500 mb-4 flex justify-center"><Icons.Alert /></div>
                    <h2 className="text-xl font-bold mb-2">Configuration Manquante</h2>
                    <p className="text-slate-600 mb-4">Vous devez éditer le fichier <code>index.html</code> sur GitHub et coller vos clés Firebase.</p>
                    <a href="https://console.firebase.google.com" target="_blank" className="text-blue-600 underline">Aller sur Firebase Console</a>
                </div>
            </div>
        );

        // --- COMPOSANT SIMULATEUR ---
        const CalculatorView = () => {
            const [grades, setGrades] = useState({});
            const [res, setRes] = useState(null);
            
            const calculate = () => {
                let pts = 0, coeffs = 0;
                BAC_DATA.math.subjects.forEach(s => {
                    const g = parseFloat(grades[s.id] || 0);
                    if(s.isOption) { if(g > 10) pts += (g - 10); }
                    else { pts += g * s.coeff; coeffs += s.coeff; }
                });
                const moy = pts / coeffs;
                const score = BAC_DATA.math.scoreFormula(moy, grades);
                setRes({ moy: moy.toFixed(2), score: score.toFixed(2) });
            };

            return (
                <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                    <h3 className="font-bold text-lg mb-4 text-slate-800">Simulateur Maths</h3>
                    <div className="grid grid-cols-1 sm:grid-cols-2 gap-3 mb-6">
                        {BAC_DATA.math.subjects.map(s => (
                            <div key={s.id} className="flex justify-between items-center bg-slate-50 p-2 rounded">
                                <label className="text-sm font-medium">{s.name}</label>
                                <input type="number" className="w-16 p-1 border rounded text-center" placeholder="/20" onChange={e => setGrades({...grades, [s.id]: e.target.value})} />
                            </div>
                        ))}
                    </div>
                    <button onClick={calculate} className="w-full bg-indigo-600 text-white py-3 rounded-xl font-bold hover:bg-indigo-700 transition">Calculer</button>
                    {res && <div className="mt-4 text-center p-4 bg-indigo-50 rounded-xl"><div className="text-3xl font-black text-indigo-600">{res.moy}</div><div className="text-sm text-indigo-800">Score: {res.score}</div></div>}
                </div>
            );
        };

        // --- COMPOSANT BIBLIOTHÈQUE ---
        const LibraryView = () => {
            const [files, setFiles] = useState([]);
            const [loading, setLoading] = useState(false);
            const [uploading, setUploading] = useState(false);
            const [file, setFile] = useState(null);
            const [meta, setMeta] = useState({ title: "", author: "" });

            useEffect(() => {
                const initAuth = async () => {
                    setLoading(true);
                    await signInAnonymously(auth);
                    const q = query(collection(db, "resources"), orderBy("createdAt", "desc"));
                    const snap = await getDocs(q);
                    setFiles(snap.docs.map(d => d.data()));
                    setLoading(false);
                };
                initAuth();
            }, [uploading]);

            const handleUpload = async (e) => {
                e.preventDefault();
                if(!file) return;
                setUploading(true);
                try {
                    const fRef = ref(storage, `docs/${Date.now()}_${file.name}`);
                    await uploadBytes(fRef, file);
                    const url = await getDownloadURL(fRef);
                    await addDoc(collection(db, "resources"), {
                        ...meta, url, createdAt: new Date(), type: "PDF"
                    });
                    alert("Fichier envoyé !");
                    setFile(null);
                } catch(err) { console.error(err); alert("Erreur upload"); }
                setUploading(false);
            };

            return (
                <div className="space-y-6">
                    <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                        <h3 className="font-bold mb-4 flex gap-2"><Icons.Upload /> Ajouter un fichier</h3>
                        <form onSubmit={handleUpload} className="space-y-3">
                            <input className="w-full p-2 border rounded" placeholder="Titre" onChange={e => setMeta({...meta, title: e.target.value})} required />
                            <input className="w-full p-2 border rounded" placeholder="Auteur" onChange={e => setMeta({...meta, author: e.target.value})} required />
                            <input type="file" className="w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:bg-indigo-50 file:text-indigo-700" onChange={e => setFile(e.target.files[0])} required />
                            <button disabled={uploading} className="w-full bg-indigo-600 text-white py-2 rounded font-bold flex justify-center items-center gap-2">
                                {uploading ? <Icons.Loader /> : "Publier"}
                            </button>
                        </form>
                    </div>

                    <div className="space-y-3">
                        {loading ? <div className="text-center p-4"><Icons.Loader /></div> : files.map((f, i) => (
                            <div key={i} className="bg-white p-4 rounded-xl shadow-sm border border-slate-200 flex justify-between items-center">
                                <div className="flex items-center gap-3">
                                    <div className="bg-red-100 p-2 rounded text-red-600"><Icons.FileText /></div>
                                    <div><div className="font-bold">{f.title}</div><div className="text-xs text-slate-500">{f.author}</div></div>
                                </div>
                                <a href={f.url} target="_blank" className="bg-indigo-50 text-indigo-600 px-3 py-1 rounded text-sm font-bold hover:bg-indigo-100">Voir</a>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        // --- APP PRINCIPALE ---
        const App = () => {
            const [tab, setTab] = useState('calc');
            if (configError) return <ConfigError />;

            return (
                <div className="max-w-3xl mx-auto min-h-screen pb-20">
                    <header className="bg-white border-b border-slate-200 sticky top-0 z-10 px-4 py-4 mb-6 flex items-center justify-between shadow-sm">
                        <div className="flex items-center gap-2 font-bold text-xl text-indigo-600">
                            <Icons.GraduationCap /> BacHub
                        </div>
                        <div className="text-xs font-mono bg-slate-100 px-2 py-1 rounded">vGitHub</div>
                    </header>

                    <main className="px-4">
                        <div className="flex gap-2 mb-6 bg-white p-1 rounded-xl shadow-sm border border-slate-200 overflow-x-auto">
                            {['calc', 'library'].map(t => (
                                <button key={t} onClick={() => setTab(t)} className={`flex-1 py-2 px-4 rounded-lg text-sm font-bold whitespace-nowrap transition-colors ${tab === t ? 'bg-indigo-600 text-white' : 'text-slate-500 hover:bg-slate-50'}`}>
                                    {t === 'calc' ? 'Simulateur' : 'Bibliothèque Cloud'}
                                </button>
                            ))}
                        </div>

                        {tab === 'calc' ? <CalculatorView /> : <LibraryView />}
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
