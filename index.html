<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bac Tunisie Hub - Sauvegarde Cloud</title>
    
    <!-- 1. Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: { slate: { 750: '#1e293b' }, indigo: { 450: '#6366f1' } },
                    animation: { 'fadeIn': 'fadeIn 0.5s ease-out', 'slideUp': 'slideUp 0.5s ease-out' },
                    keyframes: {
                        fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } },
                        slideUp: { '0%': { transform: 'translateY(20px)', opacity: '0' }, '100%': { transform: 'translateY(0)', opacity: '1' } }
                    }
                }
            }
        }
    </script>
    
    <!-- 2. React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .custom-scrollbar::-webkit-scrollbar { width: 5px; height: 5px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        .dark .custom-scrollbar::-webkit-scrollbar-thumb { background: #475569; }
        body { -webkit-tap-highlight-color: transparent; }
    </style>
</head>
<body class="bg-slate-50 dark:bg-[#0f172a] text-slate-900 dark:text-slate-100 transition-colors duration-300">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, orderBy, query } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        // --- A. VOS CLÉS FIREBASE ---
        const firebaseConfig = {
            apiKey: "AIzaSyA0EvT1wX89zK6RYbyoWwoxfQjVsi_iro4",
            authDomain: "https://mtouzri239-star.github.io/bac-tunisie/",
            projectId: "bac-tunisie-hub",
            storageBucket: "bac-tunisie-hub.firebasestorage.app",
            messagingSenderId: "197783232548",
            appId: "1:197783232548:web:357418ad0cb99a741fb8b1",
            measurementId: "G-HC44GFL8MW"
        };

        // --- Initialisation ---
        let app, db, storage, auth;
        try {
            app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            storage = getStorage(app);
            auth = getAuth(app);
        } catch (e) { console.error("Erreur Firebase", e); }

        const { useState, useEffect } = React;

        // --- B. ICÔNES ---
        const Icons = {
            GraduationCap: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 10v6M2 10l10-5 10 5-10 5z"/><path d="M6 12v5c3 0 6-3 6-7 0 5 6 7 6 7v-5M12 22v-7"/></svg>,
            Calculator: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="16" height="20" x="4" y="2" rx="2"/><line x1="8" x2="16" y1="6" y2="6"/><line x1="16" x2="16" y1="14" y2="18"/><path d="M16 10h.01"/><path d="M12 10h.01"/><path d="M8 10h.01"/><path d="M12 14h.01"/><path d="M8 14h.01"/><path d="M12 18h.01"/><path d="M8 18h.01"/></svg>,
            Book: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg>,
            Calendar: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></svg>,
            Upload: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></svg>,
            FileText: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" x2="8" y1="13" y2="13"/><line x1="16" x2="8" y1="17" y2="17"/><line x1="10" x2="8" y1="9" y2="9"/></svg>,
            Eye: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></svg>,
            Download: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>,
            Loader: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="animate-spin"><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg>,
            Moon: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 3a6 6 0 0 0 9 9 9 0 1 1-9-9Z"/></svg>,
            Sun: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg>,
            Plus: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M5 12h14"/><path d="M12 5v14"/></svg>,
            CheckCircle: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><path d="m9 11 3 3L22 4"/></svg>,
            Trash2: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>,
            Video: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m22 8-6 4 6 4V8Z"/><rect width="14" height="12" x="2" y="6" rx="2" ry="2"/></svg>,
            Image: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><circle cx="9" cy="9" r="2"/><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/></svg>,
            X: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 6 6 18"/><path d="m6 6 18 12"/></svg>
        };

        // --- C. DONNÉES ---
        const BAC_DATA = {
            math: { label: "Maths", color: "from-blue-600 to-indigo-600", subjects: [ {id:"math",name:"Maths",coeff:4}, {id:"phy",name:"Physique",coeff:4}, {id:"fr",name:"Français",coeff:1}, {id:"eng",name:"Anglais",coeff:1}, {id:"philo",name:"Philo",coeff:1}, {id:"arabe",name:"Arabe",coeff:1}, {id:"info",name:"Info",coeff:1}, {id:"svt",name:"SVT",coeff:1}, {id:"sport",name:"Sport",coeff:1}, {id:"opt",name:"Option",coeff:1,isOption:true} ], scoreFormula: (mg, g) => 4*mg + 2*(g.math||0) + 1.5*(g.phy||0) + 0.5*(g.fr||0) + 0.5*(g.eng||0) },
            sc_exp: { label: "Sciences", color: "from-emerald-600 to-teal-600", subjects: [ {id:"svt",name:"SVT",coeff:4}, {id:"phy",name:"Physique",coeff:4}, {id:"math",name:"Maths",coeff:3}, {id:"fr",name:"Français",coeff:1}, {id:"eng",name:"Anglais",coeff:1}, {id:"philo",name:"Philo",coeff:1}, {id:"arabe",name:"Arabe",coeff:1}, {id:"info",name:"Info",coeff:1}, {id:"sport",name:"Sport",coeff:1}, {id:"opt",name:"Option",coeff:1,isOption:true} ], scoreFormula: (mg, g) => 4*mg + 1.5*(g.svt||0) + 1.5*(g.phy||0) + 1*(g.math||0) + 0.5*(g.fr||0) + 0.5*(g.eng||0) },
            tech: { label: "Technique", color: "from-amber-600 to-orange-600", subjects: [ {id:"tech",name:"Technique",coeff:4}, {id:"phy",name:"Physique",coeff:4}, {id:"math",name:"Maths",coeff:3}, {id:"fr",name:"Français",coeff:1}, {id:"eng",name:"Anglais",coeff:1}, {id:"philo",name:"Philo",coeff:1}, {id:"arabe",name:"Arabe",coeff:1}, {id:"info",name:"Info",coeff:1}, {id:"sport",name:"Sport",coeff:1}, {id:"opt",name:"Option",coeff:1,isOption:true} ], scoreFormula: (mg, g) => 4*mg + 1.5*(g.tech||0) + 1.5*(g.phy||0) + 1*(g.math||0) + 0.5*(g.fr||0) + 0.5*(g.eng||0) },
            eco: { label: "Eco-Gestion", color: "from-cyan-600 to-blue-600", subjects: [ {id:"eco",name:"Eco",coeff:3}, {id:"gestion",name:"Gestion",coeff:3}, {id:"math",name:"Maths",coeff:2}, {id:"hg",name:"Hist-Géo",coeff:2}, {id:"fr",name:"Français",coeff:1}, {id:"eng",name:"Anglais",coeff:1}, {id:"arabe",name:"Arabe",coeff:1}, {id:"philo",name:"Philo",coeff:1}, {id:"info",name:"Info",coeff:1}, {id:"sport",name:"Sport",coeff:1}, {id:"opt",name:"Option",coeff:1,isOption:true} ], scoreFormula: (mg, g) => 4*mg + 1.5*(g.eco||0) + 1.5*(g.gestion||0) + 0.5*(g.math||0) + 0.5*(g.hg||0) + 0.5*(g.fr||0) + 0.5*(g.eng||0) },
            info: { label: "Info", color: "from-violet-600 to-purple-600", subjects: [ {id:"algo",name:"Algo",coeff:4}, {id:"base",name:"BDD",coeff:3}, {id:"math",name:"Maths",coeff:3}, {id:"phy",name:"Physique",coeff:2}, {id:"fr",name:"Français",coeff:1}, {id:"eng",name:"Anglais",coeff:1}, {id:"philo",name:"Philo",coeff:1}, {id:"arabe",name:"Arabe",coeff:1}, {id:"sport",name:"Sport",coeff:1}, {id:"opt",name:"Option",coeff:1,isOption:true} ], scoreFormula: (mg, g) => 4*mg + 1.5*(g.algo||0) + 1.5*(g.math||0) + 0.5*(g.phy||0) + 0.5*(g.fr||0) + 0.5*(g.eng||0) },
            lettres: { label: "Lettres", color: "from-pink-600 to-rose-600", subjects: [ {id:"arabe",name:"Arabe",coeff:4}, {id:"philo",name:"Philo",coeff:4}, {id:"hg",name:"Hist-Géo",coeff:3}, {id:"fr",name:"Français",coeff:2}, {id:"eng",name:"Anglais",coeff:2}, {id:"info",name:"Info",coeff:1}, {id:"math",name:"Maths",coeff:1}, {id:"sport",name:"Sport",coeff:1}, {id:"opt",name:"Option",coeff:1,isOption:true} ], scoreFormula: (mg, g) => 4*mg + 1.5*(g.arabe||0) + 1.5*(g.philo||0) + 1*(g.hg||0) + 0.5*(g.fr||0) + 0.5*(g.eng||0) }
        };

        const IMPORTANT_DATES = [
            { event: "Bac Sport", date: "15 Avr 2025" },
            { event: "Bac Blanc", date: "10 Mai 2025" },
            { event: "Bac Principal", date: "04 Juin 2025" },
            { event: "Résultats", date: "25 Juin 2025" }
        ];

        // --- D. COMPOSANTS ---

        // 1. Calculateur
        const CalculatorView = ({ section }) => {
            const [grades, setGrades] = useState({});
            const [res, setRes] = useState(null);
            
            useEffect(() => { setGrades({}); setRes(null); }, [section]);

            const calculate = () => {
                let pts = 0, coeffs = 0;
                BAC_DATA[section].subjects.forEach(s => {
                    const g = parseFloat(grades[s.id] || 0);
                    if(s.isOption) { if(g > 10) pts += (g - 10); }
                    else { pts += g * s.coeff; coeffs += s.coeff; }
                });
                const moy = pts / coeffs;
                const score = BAC_DATA[section].scoreFormula(moy, grades);
                setRes({ moy: moy.toFixed(2), score: score.toFixed(2) });
            };

            return (
                <div className="bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-sm border border-slate-200 dark:border-slate-700 animate-fadeIn">
                    <h3 className="font-bold text-lg mb-6 text-slate-800 dark:text-white flex items-center gap-2">
                        <Icons.Calculator className="text-indigo-500" /> Simulateur {BAC_DATA[section].label}
                    </h3>
                    <div className="grid grid-cols-2 sm:grid-cols-3 gap-3 mb-6">
                        {BAC_DATA[section].subjects.map(s => (
                            <div key={s.id} className="bg-slate-50 dark:bg-slate-700/50 p-2.5 rounded-xl border border-transparent focus-within:border-indigo-500 transition-colors">
                                <label className="block text-xs font-medium text-slate-500 dark:text-slate-400 mb-1">{s.name} <span className="opacity-50">x{s.coeff}</span></label>
                                <input type="number" className="w-full bg-transparent font-bold text-slate-900 dark:text-white outline-none" placeholder="-" onChange={e => setGrades({...grades, [s.id]: e.target.value})} />
                            </div>
                        ))}
                    </div>
                    <button onClick={calculate} className={`w-full bg-gradient-to-r ${BAC_DATA[section].color} text-white py-3.5 rounded-xl font-bold shadow-lg shadow-indigo-500/20 hover:scale-[1.02] active:scale-95 transition-all`}>Calculer</button>
                    {res && (
                        <div className="mt-6 p-6 bg-slate-900 rounded-2xl text-white shadow-xl animate-fadeIn text-center relative overflow-hidden">
                            <div className="absolute top-0 right-0 w-20 h-20 bg-white/10 rounded-full blur-2xl -mr-10 -mt-10"></div>
                            <div className="text-5xl font-black mb-1 tracking-tight">{res.moy}</div>
                            <div className="text-xs font-bold text-slate-400 uppercase tracking-widest mb-4">Moyenne Générale</div>
                            <div className="inline-block bg-white/10 px-4 py-1 rounded-full text-sm font-mono text-indigo-300">Score FG: {res.score}</div>
                        </div>
                    )}
                </div>
            );
        };

        // 2. Agenda
        const PlanningView = () => {
            const [tasks, setTasks] = useState(() => JSON.parse(localStorage.getItem('bac_tasks') || '[]'));
            const [newTask, setNewTask] = useState("");
            
            useEffect(() => localStorage.setItem('bac_tasks', JSON.stringify(tasks)), [tasks]);

            const addTask = (e) => {
                e.preventDefault();
                if(!newTask.trim()) return;
                setTasks([...tasks, { id: Date.now(), text: newTask, done: false }]);
                setNewTask("");
            };

            const toggle = (id) => setTasks(tasks.map(t => t.id === id ? {...t, done: !t.done} : t));
            const del = (id) => setTasks(tasks.filter(t => t.id !== id));
            const daysLeft = Math.ceil((new Date("2025-06-04") - new Date()) / (1000 * 60 * 60 * 24));

            return (
                <div className="space-y-6 animate-fadeIn">
                    <div className="bg-slate-900 dark:bg-black rounded-2xl p-8 text-white text-center shadow-xl relative overflow-hidden group">
                        <div className="absolute inset-0 bg-gradient-to-br from-indigo-600 to-purple-600 opacity-20 group-hover:opacity-30 transition-opacity"></div>
                        <div className="relative z-10">
                            <div className="text-6xl font-black mb-2 flex items-baseline justify-center gap-2">
                                {Math.max(0, daysLeft)} <span className="text-lg font-medium text-slate-400">Jours</span>
                            </div>
                            <div className="text-sm font-medium text-slate-400 uppercase tracking-widest">Avant le Bac 2025</div>
                        </div>
                    </div>

                    <div className="grid md:grid-cols-2 gap-6">
                        <div className="bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-sm border border-slate-200 dark:border-slate-700">
                            <h4 className="font-bold mb-6 flex gap-2 dark:text-white items-center"><Icons.Calendar className="text-red-500"/> Dates Clés</h4>
                            <div className="space-y-4">
                                {IMPORTANT_DATES.map((d,i) => (
                                    <div key={i} className="flex items-center gap-4">
                                        <div className="w-12 h-12 bg-slate-100 dark:bg-slate-700 rounded-xl flex flex-col items-center justify-center font-bold text-slate-700 dark:text-slate-300 text-xs shadow-sm">
                                            <span className="text-lg">{d.date.split(' ')[0]}</span>
                                            <span className="uppercase text-[10px]">{d.date.split(' ')[1]}</span>
                                        </div>
                                        <div>
                                            <div className="font-bold text-slate-800 dark:text-white">{d.event}</div>
                                            <div className="text-xs text-slate-500 dark:text-slate-400">Session 2025</div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>

                        <div className="bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-sm border border-slate-200 dark:border-slate-700 flex flex-col h-full">
                            <div className="flex justify-between items-center mb-6">
                                <h4 className="font-bold flex gap-2 dark:text-white items-center"><Icons.CheckCircle className="text-green-500"/> Tâches</h4>
                                <span className="text-[10px] bg-slate-100 dark:bg-slate-700 text-slate-500 px-2 py-1 rounded-full font-bold">Auto-Save</span>
                            </div>
                            <form onSubmit={addTask} className="flex gap-2 mb-4">
                                <input className="flex-1 px-4 py-2 border rounded-xl dark:bg-slate-700 dark:border-slate-600 dark:text-white outline-none focus:ring-2 focus:ring-indigo-500 transition-all" placeholder="Nouvelle tâche..." value={newTask} onChange={e => setNewTask(e.target.value)} />
                                <button className="bg-indigo-600 text-white p-2.5 rounded-xl hover:bg-indigo-700 transition shadow-lg shadow-indigo-500/20"><Icons.Plus /></button>
                            </form>
                            <div className="space-y-2 max-h-60 overflow-y-auto custom-scrollbar flex-1">
                                {tasks.map(t => (
                                    <div key={t.id} className="flex items-center justify-between group p-3 bg-slate-50 dark:bg-slate-700/50 hover:bg-white dark:hover:bg-slate-700 border border-transparent hover:border-slate-200 dark:hover:border-slate-600 rounded-xl transition-all">
                                        <div className="flex items-center gap-3 cursor-pointer overflow-hidden" onClick={() => toggle(t.id)}>
                                            <div className={`w-5 h-5 rounded-full border-2 flex items-center justify-center transition-all ${t.done ? 'bg-green-500 border-green-500' : 'border-slate-300 dark:border-slate-500'}`}>
                                                {t.done && <Icons.CheckCircle className="text-white w-3 h-3" />}
                                            </div>
                                            <span className={`text-sm truncate ${t.done ? 'line-through text-slate-400' : 'dark:text-slate-200 font-medium'}`}>{t.text}</span>
                                        </div>
                                        <button onClick={() => del(t.id)} className="text-slate-300 hover:text-red-500 transition opacity-0 group-hover:opacity-100"><Icons.Trash2 className="w-4 h-4" /></button>
                                    </div>
                                ))}
                                {tasks.length === 0 && <div className="text-center py-8 text-slate-400 italic text-sm">Aucune tâche. Repos mérité ?</div>}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // 3. Bibliothèque Cloud (AVEC TÉLÉCHARGEMENT)
        const LibraryView = ({ section }) => {
            const [files, setFiles] = useState([]);
            const [loading, setLoading] = useState(false);
            const [uploading, setUploading] = useState(false);
            const [showForm, setShowForm] = useState(false);
            const [file, setFile] = useState(null);
            const [meta, setMeta] = useState({ title: "", author: "" });
            const [user, setUser] = useState(null);

            useEffect(() => {
                let unsubscribe = () => {};
                const initAuth = async () => {
                    setLoading(true);
                    
                    // Attempt to connect if not already
                    if (!auth.currentUser) {
                        try {
                            await signInAnonymously(auth);
                        } catch (error) {
                            console.error("Auth Error:", error);
                            if (error.code === 'auth/admin-restricted-operation') {
                                alert("Attention : Vous devez activer l'authentification ANONYME dans la console Firebase (Authentication > Sign-in method) pour que la bibliothèque fonctionne.");
                            }
                            setLoading(false);
                            return;
                        }
                    }

                    unsubscribe = onAuthStateChanged(auth, async (u) => {
                        setUser(u);
                        if (u) {
                            try {
                                const q = query(collection(db, "resources"), orderBy("createdAt", "desc"));
                                const snap = await getDocs(q);
                                setFiles(snap.docs.map(d => d.data()));
                            } catch (e) { console.error(e); }
                        }
                        setLoading(false);
                    });
                };
                initAuth();
                return () => unsubscribe();
            }, [uploading]);

            const handleUpload = async (e) => {
                e.preventDefault();
                if(!file) return;
                setUploading(true);
                try {
                    const uniqueName = `docs/${Date.now()}_${file.name}`;
                    const fRef = ref(storage, uniqueName);
                    await uploadBytes(fRef, file);
                    const url = await getDownloadURL(fRef);
                    
                    let type = "PDF";
                    if(file.type.includes("image")) type = "Image";
                    if(file.type.includes("video")) type = "Video";
                    
                    await addDoc(collection(db, "resources"), {
                        ...meta, 
                        url, 
                        type, 
                        section, 
                        createdAt: new Date()
                    });
                    alert("Document sauvegardé dans le Cloud !");
                    setFile(null);
                    setShowForm(false);
                } catch(err) { console.error(err); alert("Erreur upload : " + err.message); }
                setUploading(false);
            };

            return (
                <div className="space-y-6 animate-fadeIn">
                    <div className={`bg-gradient-to-r ${BAC_DATA[section].color} rounded-2xl p-6 text-white shadow-lg flex justify-between items-center relative overflow-hidden`}>
                        <div className="absolute top-0 right-0 w-32 h-32 bg-white opacity-10 rounded-full blur-3xl -mr-10 -mt-10"></div>
                        <div className="relative z-10">
                            <h3 className="font-bold text-xl flex gap-2 items-center"><Icons.Book /> Bibliothèque</h3>
                            <p className="text-sm opacity-80 mt-1">{user ? "Connecté au Cloud (Mode Lecture/Écriture)" : "Connexion..."}</p>
                        </div>
                        <button onClick={() => setShowForm(!showForm)} className="bg-white/20 backdrop-blur-md p-3 rounded-full hover:bg-white/30 transition shadow-lg relative z-10">
                            {showForm ? <Icons.X /> : <Icons.Plus />}
                        </button>
                    </div>

                    {showForm && (
                        <form onSubmit={handleUpload} className="bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-xl border dark:border-slate-700 animate-slideUp">
                            <h4 className="font-bold mb-6 dark:text-white flex items-center gap-2"><Icons.Upload className="text-indigo-500"/> Sauvegarder un fichier</h4>
                            <div className="grid gap-4">
                                <div className="grid grid-cols-2 gap-4">
                                    <div>
                                        <label className="text-xs font-bold text-slate-500 mb-1 block">Titre</label>
                                        <input className="w-full p-2.5 border rounded-xl dark:bg-slate-700 dark:border-slate-600 dark:text-white outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Ex: Chapitre 1" onChange={e => setMeta({...meta, title: e.target.value})} required />
                                    </div>
                                    <div>
                                        <label className="text-xs font-bold text-slate-500 mb-1 block">Auteur</label>
                                        <input className="w-full p-2.5 border rounded-xl dark:bg-slate-700 dark:border-slate-600 dark:text-white outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Votre nom" onChange={e => setMeta({...meta, author: e.target.value})} required />
                                    </div>
                                </div>
                                <div className="border-2 border-dashed border-slate-300 dark:border-slate-600 rounded-xl p-6 text-center hover:bg-slate-50 dark:hover:bg-slate-700/50 transition cursor-pointer relative">
                                    <input type="file" className="absolute inset-0 w-full h-full opacity-0 cursor-pointer" onChange={e => setFile(e.target.files[0])} required />
                                    <div className="pointer-events-none">
                                        {file ? (
                                            <span className="text-green-500 font-bold flex items-center justify-center gap-2"><Icons.CheckCircle/> {file.name}</span>
                                        ) : (
                                            <span className="text-slate-400 dark:text-slate-500 flex flex-col items-center gap-2">
                                                <Icons.Upload className="w-8 h-8"/>
                                                <span>Cliquez pour choisir un PDF, Image ou Vidéo</span>
                                            </span>
                                        )}
                                    </div>
                                </div>
                                <button disabled={uploading} className="w-full bg-indigo-600 text-white py-3 rounded-xl font-bold flex justify-center items-center gap-2 hover:bg-indigo-700 transition disabled:opacity-50 shadow-lg shadow-indigo-500/20">
                                    {uploading ? <><Icons.Loader className="w-5 h-5"/> Envoi...</> : "Publier maintenant"}
                                </button>
                            </div>
                        </form>
                    )}

                    <div className="grid md:grid-cols-2 gap-4">
                        {loading ? <div className="col-span-2 text-center p-12 text-indigo-500"><Icons.Loader className="w-8 h-8 mx-auto"/></div> : files.map((f, i) => (
                            <div key={i} className="bg-white dark:bg-slate-800 p-4 rounded-2xl shadow-sm border border-slate-200 dark:border-slate-700 hover:shadow-md hover:border-indigo-200 dark:hover:border-indigo-800 transition group">
                                <div className="flex items-center gap-4">
                                    <div className={`w-12 h-12 rounded-2xl flex items-center justify-center shadow-sm ${f.type === 'PDF' ? 'bg-red-100 text-red-600' : f.type === 'Video' ? 'bg-purple-100 text-purple-600' : 'bg-blue-100 text-blue-600'}`}>
                                        {f.type === 'PDF' ? <Icons.FileText /> : f.type === 'Video' ? <Icons.Video /> : <Icons.Image />}
                                    </div>
                                    <div className="flex-1 min-w-0">
                                        <h4 className="font-bold text-slate-800 dark:text-slate-100 truncate">{f.title}</h4>
                                        <div className="flex items-center gap-2 text-xs text-slate-500 dark:text-slate-400 mt-1">
                                            <span className="bg-slate-100 dark:bg-slate-700 px-2 py-0.5 rounded-full">{f.type}</span>
                                            <span>{f.author}</span>
                                        </div>
                                    </div>
                                    <div className="flex gap-2">
                                        <a href={f.url} target="_blank" className="p-2 bg-slate-100 dark:bg-slate-700 rounded-xl text-slate-600 dark:text-slate-300 hover:bg-indigo-100 dark:hover:bg-indigo-900/30 hover:text-indigo-600 dark:hover:text-indigo-400 transition" title="Voir">
                                            <Icons.Eye className="w-5 h-5"/>
                                        </a>
                                        <a href={f.url} download target="_blank" className="p-2 bg-slate-100 dark:bg-slate-700 rounded-xl text-slate-600 dark:text-slate-300 hover:bg-green-100 dark:hover:bg-green-900/30 hover:text-green-600 dark:hover:text-green-400 transition" title="Télécharger">
                                            <Icons.Download className="w-5 h-5"/>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        ))}
                        {!loading && files.length === 0 && <div className="col-span-2 text-center p-12 text-slate-400 border-2 border-dashed border-slate-200 dark:border-slate-700 rounded-2xl">La bibliothèque est vide pour le moment.</div>}
                    </div>
                </div>
            );
        };

        // --- E. APP PRINCIPALE ---
        const App = () => {
            const [tab, setTab] = useState('calc');
            const [section, setSection] = useState('math');
            const [darkMode, setDarkMode] = useState(false);

            // SELECTEUR DE SECTION (CSS Custom)
            const SectionSelector = ({ selected, onSelect }) => (
                <div className="flex gap-2 mb-6 overflow-x-auto pb-2 custom-scrollbar">
                    {Object.entries(BAC_DATA).map(([key, data]) => (
                        <button key={key} onClick={() => onSelect(key)} className={`px-4 py-2 rounded-full text-sm font-bold whitespace-nowrap transition-all ${selected === key ? `bg-gradient-to-r ${data.color} text-white shadow-md` : 'bg-white dark:bg-slate-800 text-slate-600 dark:text-slate-300 border dark:border-slate-700'}`}>
                            {data.label}
                        </button>
                    ))}
                </div>
            );

            return (
                <div className={darkMode ? 'dark' : ''}>
                    <div className="min-h-screen bg-slate-50 dark:bg-[#0f172a] text-slate-900 dark:text-slate-100 transition-colors duration-300 pb-24">
                        <header className="sticky top-0 z-50 bg-white/80 dark:bg-[#0f172a]/80 backdrop-blur-xl border-b border-slate-200 dark:border-slate-800 px-4 py-3 shadow-sm transition-colors">
                            <div className="max-w-3xl mx-auto flex justify-between items-center">
                                <div className="flex items-center gap-2.5">
                                    <div className="bg-gradient-to-br from-red-600 to-rose-600 text-white p-1.5 rounded-lg shadow-lg shadow-red-500/20"><Icons.GraduationCap /></div>
                                    <div><h1 className="text-lg font-bold leading-none tracking-tight">Bac<span className="text-red-600">Tunisie</span></h1><span className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Hub Éducatif</span></div>
                                </div>
                                <button onClick={() => setDarkMode(!darkMode)} className="p-2.5 rounded-full bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-400 hover:bg-slate-200 dark:hover:bg-slate-700 transition">
                                    {darkMode ? <Icons.Sun /> : <Icons.Moon />}
                                </button>
                            </div>
                        </header>

                        <main className="max-w-3xl mx-auto p-4 pt-6">
                            <SectionSelector selected={section} onSelect={setSection} />
                            <div className="flex p-1.5 bg-white dark:bg-slate-800 rounded-2xl shadow-sm border border-slate-200 dark:border-slate-700 mb-8 overflow-x-auto">
                                {[ {id:'calc', label:'Simulateur', icon: <Icons.Calculator/>}, {id:'planning', label:'Agenda', icon: <Icons.Calendar/>}, {id:'library', label:'Biblio', icon: <Icons.Book/>} ].map(t => (
                                    <button key={t.id} onClick={() => setTab(t.id)} className={`flex-1 flex items-center justify-center gap-2 py-3 px-4 rounded-xl text-sm font-bold transition-all whitespace-nowrap ${tab === t.id ? 'bg-slate-900 dark:bg-white text-white dark:text-slate-900 shadow-md scale-[1.02]' : 'text-slate-500 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-700/50'}`}>
                                        <span className="scale-90 opacity-80">{t.icon}</span> {t.label}
                                    </button>
                                ))}
                            </div>
                            {tab === 'calc' && <CalculatorView section={section} />}
                            {tab === 'planning' && <PlanningView />}
                            {tab === 'library' && <LibraryView section={section} />}
                        </main>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
